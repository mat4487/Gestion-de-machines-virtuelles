\lstset{language=bash}
\chapter{Ganeti}
\section{Présentation}
Ganeti est un outil de gestion de machines virtuelles se basant sur les technologies de virtualisation existantes comme XEN et KVM.\\
Ganeti nécessite un logiciel de virtualisation pré-installé sur les serveurs afin de pouvoir fonctionner. 

Une fois installé, l'outil prendra en charge la partie gestion des instances virtuelles (Xen DomU), par exemple, la gestion de création de disque, l'installation du système d'exploitation (en coopération avec les scripts d'installation du système d'exploitation spécifique), et le démarrage, l'arrêt, le basculement entre les systèmes physiques. Il a été conçu pour faciliter la gestion de cluster de serveurs virtuels et de fournir une récupération rapide et simple.
\section{Installation}
installer ganeti :
\begin{lstlisting}
apt-get install ganeti2 ganeti-htools ganeti-instance-debootstrap
\end{lstlisting}
Dans /etc/host ajouter l'adresse IP du node avec le nom de l'host ainsi que l'adresse du cluster :
\begin{lstlisting}
10.144.64.1 cluster1
172.16.65.56 griffon-56.nancy.grid5000.fr
\end{lstlisting}
Lorsque on aura plusieur nodes il faudra une autre adresse Ip au cluster car elle doit etre accessible à tous les nodes

Dans /boot/ creer des liens symboliques :
\begin{lstlisting}
ln -s vmlinuz-2.6.32-5-xen-amd64 vmlinuz-2.6.xenU
ln -s initrd.img-2.6.32-5-xen-amd64 initrd.img-2.6.xenU
\end{lstlisting}

Creer un LVM d'au moins 20Go (Obligatoire) :
\begin{lstlisting}
umout /dev/sda5
pvcreate /dev/sda5
vgcreate xenvg /dev/sda5
\end{lstlisting}
Dans /ect/network/interface remplacer le paragraphe de eth0 par celle du brige xen-br0 :
\begin{lstlisting}
auto xen-br0
iface xen-br0 inet static
 address 172.16.65.56 #Adresse du node
 netmask 255.255.240.0 
 network 172.16.64.0
 broadcast 172.16.79.255
 gateway 10.144.64.254
 bridge_ports eth0
 bridge_stp off
 bridge_fd 0
\end{lstlisting}
\section{Utilisation}

Initialiser le cluster avec ganeti :
\begin{lstlisting}
gnt-custer init --no-drbd-storage cluster1
\end{lstlisting}
ajouter le node
\begin{lstlisting}
gnt-node add griffon-56.nancy.grid5000.fr
\end{lstlisting}
et verifier avec :
\begin{lstlisting}
gnt-node list
\end{lstlisting}
Qui devrait renvoyer quelque chose comme cela :
\begin{lstlisting}
Node                         DTotal  DFree MTotal MNode MFree Pinst Sinst
griffon-56.nancy.grid5000.fr 283.2G 283.2G      -     -     -     0     0
\end{lstlisting}
